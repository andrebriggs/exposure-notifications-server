parameters:
- name: imageName
  type: string
- name: acrName
  type: string

steps:
- script: |-
    echo imageName: ${{ parameters.imageName }}
    echo acrName: ${{ parameters.acrName }}
  failOnStderr: true
  displayName: Debugging messages
- script: |
    # Docker
    export BRANCH_NAME=$(echo $(Build.SourceBranchName) | tr / - | tr . - | tr _ - )
    export IMAGE_TAG=$(echo $(Build.BuildNumber) | tr / - | tr . - | tr _ - )
    az acr build -r ${{ parameters.acrName }} --image ${{ parameters.imageName }}-$BRANCH_NAME:$IMAGE_TAG . --build-arg SERVICE=${{ parameters.imageName }}
  displayName: 'Docker build'